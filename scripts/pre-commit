#!/bin/sh
#
# Pre-commit hook to automatically apply Spotless formatting.
#

echo "ğŸ” Checking for Java files to format..."

# ìŠ¤í…Œì´ì§•ëœ Java íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
STAGED_JAVA_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep ".java$")

if [ -z "$STAGED_JAVA_FILES" ]; then
    echo "âœ… No Java files staged. Skipping Spotless apply."
    exit 0
fi

echo "âœ¨ Java files detected. Running './gradlew spotlessApply'..."

# Spotless ì ìš© (ìë™ í¬ë§·íŒ…)
./gradlew spotlessApply --daemon

EXIT_CODE=$?

if [ $EXIT_CODE -ne 0 ]; then
    echo "âŒ Spotless apply failed! Please check the logs."
    exit 1
fi

# í¬ë§·íŒ…ìœ¼ë¡œ ì¸í•´ ë³€ê²½ëœ íŒŒì¼ë“¤ì´ ìˆë‹¤ë©´ ë‹¤ì‹œ ìŠ¤í…Œì´ì§• (git add)
# ì£¼ì˜: ìŠ¤í…Œì´ì§•ëœ íŒŒì¼ë“¤ë§Œ ë‹¤ì‹œ add í•´ì•¼ í•¨
echo "â• Re-staging formatted files..."
for file in $STAGED_JAVA_FILES; do
    if [ -f "$file" ]; then
        git add "$file"
    fi
done

echo "âœ… Spotless formatting applied and changes staged."
exit 0